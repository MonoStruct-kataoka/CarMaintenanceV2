<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>整備記録簿入力 - 特定整備記録簿システム</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/inspection.css">
</head>
<body>
    <div class="container">
        <!-- ヘッダー -->
        <div class="header">
            <div class="header-left">
                <button class="back-btn" onclick="location.href='index.html'">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <div class="header-title">
                    <span>🔧</span>
                    <span id="section-title">整備記録簿入力</span>
                </div>
            </div>
            <div class="header-info">
                <button class="legend-icon-btn" onclick="openLegendModal()" title="点検記号の説明">
                    <i class="fas fa-info-circle"></i>
                </button>
                <button class="search-shortcut-btn" onclick="location.href='search.html'" title="整備記録検索">
                    <i class="fas fa-search"></i>
                    <span>検索</span>
                </button>
                <div class="vehicle-number" id="vehicle-display">未登録</div>
                <div class="progress-badge">
                    <span id="progress-text">0 / 0 完了</span>
                </div>
            </div>
        </div>

        <!-- タブナビゲーション -->
        <div class="tab-navigation">
            <button class="tab-btn active" data-tab="vehicle">
                <span class="tab-text">車両情報</span>
            </button>
            <button class="tab-btn" data-tab="engine">
                <span class="tab-text">エンジンルーム</span>
                <span class="tab-badge">0/9</span>
            </button>
            <button class="tab-btn" data-tab="interior">
                <span class="tab-text">室内点検</span>
                <span class="tab-badge">0/7</span>
            </button>
            <button class="tab-btn" data-tab="undercarriage">
                <span class="tab-text">足廻り点検</span>
                <span class="tab-badge">0/11</span>
            </button>
            <button class="tab-btn" data-tab="bottom">
                <span class="tab-text">下廻り点検</span>
                <span class="tab-badge">0/8</span>
            </button>
            <button class="tab-btn" data-tab="obd">
                <span class="tab-text">車載式故障診断装置</span>
                <span class="tab-badge">0/1</span>
            </button>
            <button class="tab-btn" data-tab="daily">
                <span class="tab-text">日常点検</span>
                <span class="tab-badge">0/10</span>
            </button>
            <button class="tab-btn" data-tab="additional">
                <span class="tab-text">追加項目</span>
            </button>
        </div>

        <!-- メインコンテンツ -->
        <div class="main-content" id="main-content">
            <!-- 車両情報入力 -->
            <div class="tab-content active" data-content="vehicle">
                <div class="vehicle-info-container">
                    <div class="vehicle-info-grid">
                        <div class="info-card">
                            <div class="info-card-header">📋 基本情報</div>
                            <button class="qr-scan-button" onclick="scanQRCode()">
                                <span>📷</span>
                                <span>車検証QRコードをスキャン</span>
                            </button>
                            <div class="input-group">
                                <label class="input-label">依頼者の氏名又は名称 <span class="required">*</span></label>
                                <input type="text" class="input-field" id="client-name" placeholder="例：有限会社アルプス">
                            </div>
                            <div class="input-group">
                                <label class="input-label">自動車登録番号又は車両番号 <span class="required">*</span></label>
                                <input type="text" class="input-field" id="registration-number" placeholder="例：四谷 330 せ 6098">
                            </div>
                            <div class="input-group">
                                <label class="input-label">車名及び型式</label>
                                <input type="text" class="input-field" id="car-model" placeholder="例：GAA-SNT33">
                            </div>
                        </div>

                        <div class="info-card">
                            <div class="info-card-header">🚗 詳細情報</div>
                            <div class="input-group">
                                <label class="input-label">車台番号</label>
                                <input type="text" class="input-field" id="chassis-number" placeholder="例：SNT33-028686">
                            </div>
                            <div class="input-group">
                                <label class="input-label">原動機の型式</label>
                                <input type="text" class="input-field" id="engine-model" placeholder="例：MA03">
                            </div>
                            <div class="input-group">
                                <label class="input-label">初度登録年月又は初度検査年月</label>
                                <input type="text" class="input-field" id="first-registration" placeholder="例：令和6年3月">
                            </div>
                            <div class="input-group">
                                <label class="input-label">住所</label>
                                <input type="text" class="input-field" id="address" placeholder="例：東京都新宿区西新宿2-8-1">
                            </div>
                        </div>

                        <div class="info-card">
                            <div class="info-card-header">🏢 整備情報</div>
                            <div class="input-group">
                                <label class="input-label">自動車分解整備事業者の氏名又は名称(点検整備者)</label>
                                <input type="text" class="input-field" id="inspector-name" placeholder="例：株式会社日産サティオ埼玉北">
                            </div>
                            <div class="input-group">
                                <label class="input-label">事業場の所在地</label>
                                <input type="text" class="input-field" id="workshop-address" placeholder="例：埼玉県大里郡寄居町大字用土1234-5">
                            </div>
                            <div class="input-group">
                                <label class="input-label">認証番号</label>
                                <input type="text" class="input-field" id="certification-number" placeholder="例：関整第1234号">
                            </div>
                            <div class="input-group">
                                <label class="input-label">点検の年月日 <span class="required">*</span></label>
                                <input type="date" class="input-field" id="inspection-date">
                            </div>
                            <div class="input-group">
                                <label class="input-label">整備完了年月日</label>
                                <input type="date" class="input-field" id="completion-date">
                            </div>
                            <div class="input-group">
                                <label class="input-label">整備主任者の氏名</label>
                                <input type="text" class="input-field" id="chief-mechanic-name" placeholder="例：田中 太郎">
                            </div>
                            <div class="input-group">
                                <label class="input-label">点検(整備)時の総走行距離（km） <span class="required">*</span></label>
                                <input type="number" class="input-field" id="total-mileage" placeholder="例：76296">
                            </div>
                        </div>

                        <div class="info-card">
                            <div class="info-card-header">🏷️ タグ設定</div>
                            <div class="input-group">
                                <label class="input-label">タグ（カンマ区切りで複数入力可能）</label>
                                <input type="text" class="input-field" id="tags" placeholder="例：1年点検,オイル交換,タイヤ交換">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- エンジンルーム点検 -->
            <div class="tab-content" data-content="engine">
                <div class="inspection-grid" id="engine-items"></div>
            </div>

            <!-- 室内点検 -->
            <div class="tab-content" data-content="interior">
                <div class="inspection-grid" id="interior-items"></div>
            </div>

            <!-- 足廻り点検 -->
            <div class="tab-content" data-content="undercarriage">
                <div class="inspection-grid" id="undercarriage-items"></div>
            </div>

            <!-- 下廻り点検 -->
            <div class="tab-content" data-content="bottom">
                <div class="inspection-grid" id="bottom-items"></div>
            </div>

            <!-- 車載式故障診断装置点検 -->
            <div class="tab-content" data-content="obd">
                <div class="inspection-grid" id="obd-items"></div>
            </div>

            <!-- 日常点検 -->
            <div class="tab-content" data-content="daily">
                <div class="inspection-grid" id="daily-items"></div>
            </div>

            <!-- 追加項目 -->
            <div class="tab-content" data-content="additional">
                <!-- その他の点検項目等 -->
                <div class="section-card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <h3 class="section-header" style="margin: 0;">📝 その他の点検項目等</h3>
                        <button class="add-part-btn" onclick="showAddCustomItemModal()">
                            <i class="fas fa-plus"></i> 点検項目を追加
                        </button>
                    </div>
                    <div class="inspection-grid" id="custom-inspection-items"></div>
                </div>

                <!-- 主な交換部品 -->
                <div class="section-card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <h3 class="section-header" style="margin: 0;">🔄 主な交換部品等</h3>
                        <div style="display: flex; gap: 10px;">
                            <button class="overall-photo-btn" onclick="openPhotoModal('parts_overall', '交換部品全体')" title="全体写真を撮影">
                                <i class="fas fa-camera"></i> 全体写真
                            </button>
                            <button class="add-part-btn" onclick="showAddPartModal()">
                                <i class="fas fa-plus"></i> 部品を追加
                            </button>
                        </div>
                    </div>
                    <div class="replacement-grid" id="replacement-parts"></div>
                </div>

                <!-- メンテナンスアドバイス -->
                <div class="section-card">
                    <h3 class="section-header">💡 メンテナンスに関するアドバイス</h3>
                    <textarea class="advice-textarea" id="advice" placeholder="次回の点検時期や交換推奨部品など、お客様へのアドバイスを記入してください。"></textarea>
                </div>

                <!-- 測定値 -->
                <div class="section-card">
                    <h3 class="section-header">📏 測定値</h3>
                    <div class="measurement-grid" id="measurements"></div>
                </div>

                <!-- 整備事業者情報・点検実施情報 -->
                <div class="section-card">
                    <h3 class="section-header">🏢 整備事業者情報・点検実施情報</h3>
                    <div class="info-summary-grid">
                        <div class="info-summary-item">
                            <label class="info-summary-label">自動車分解整備事業者の氏名又は名称(点検整備者)</label>
                            <div class="info-summary-value" id="summary-inspector-name">-</div>
                        </div>
                        <div class="info-summary-item">
                            <label class="info-summary-label">事業場の所在地</label>
                            <div class="info-summary-value" id="summary-workshop-address">-</div>
                        </div>
                        <div class="info-summary-item">
                            <label class="info-summary-label">認証番号</label>
                            <div class="info-summary-value" id="summary-certification-number">-</div>
                        </div>
                        <div class="info-summary-item">
                            <label class="info-summary-label">点検の年月日</label>
                            <div class="info-summary-value" id="summary-inspection-date">-</div>
                        </div>
                        <div class="info-summary-item">
                            <label class="info-summary-label">整備完了年月日</label>
                            <div class="info-summary-value" id="summary-completion-date">-</div>
                        </div>
                        <div class="info-summary-item">
                            <label class="info-summary-label">整備主任者の氏名</label>
                            <div class="info-summary-value" id="summary-chief-mechanic-name">-</div>
                        </div>
                        <div class="info-summary-item">
                            <label class="info-summary-label">点検(整備)時の総走行距離</label>
                            <div class="info-summary-value" id="summary-total-mileage">-</div>
                        </div>
                    </div>
                    <div class="info-summary-note">
                        <i class="fas fa-info-circle"></i>
                        この情報は「🏢 整備情報」タブで入力した内容が自動的に表示されます。
                    </div>
                </div>
            </div>
        </div>

        <!-- フローティングボタン -->
        <div class="floating-actions">
            <button class="fab fab-secondary" onclick="saveAsDraft()">
                <i class="fas fa-save"></i> 下書き保存
            </button>
            <button class="fab fab-primary" onclick="completeInspection()">
                <i class="fas fa-check"></i> 完了
            </button>
        </div>

        <!-- 記号説明モーダル -->
        <div class="modal" id="legendModal">
            <div class="modal-content legend-modal-content">
                <div class="modal-header">
                    <h3>点検記号の説明</h3>
                    <button class="modal-close" onclick="closeLegendModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="legend-grid">
                        <div class="legend-item-modal">
                            <div class="legend-symbol-large" style="color: #4CAF50;">✓</div>
                            <div class="legend-text-large">点検良好</div>
                        </div>
                        <div class="legend-item-modal">
                            <div class="legend-symbol-large" style="color: #f44336;">×</div>
                            <div class="legend-text-large">交換</div>
                        </div>
                        <div class="legend-item-modal">
                            <div class="legend-symbol-large" style="color: #ff9800;">A</div>
                            <div class="legend-text-large">調整</div>
                        </div>
                        <div class="legend-item-modal">
                            <div class="legend-symbol-large" style="color: #2196F3;">C</div>
                            <div class="legend-text-large">清掃</div>
                        </div>
                        <div class="legend-item-modal">
                            <div class="legend-symbol-large" style="color: #9c27b0;">P</div>
                            <div class="legend-text-large">省略</div>
                        </div>
                        <div class="legend-item-modal">
                            <div class="legend-symbol-large" style="color: #795548;">○</div>
                            <div class="legend-text-large">特定整備</div>
                        </div>
                        <div class="legend-item-modal">
                            <div class="legend-symbol-large" style="color: #607d8b;">△</div>
                            <div class="legend-text-large">修理</div>
                        </div>
                        <div class="legend-item-modal">
                            <div class="legend-symbol-large" style="color: #009688;">T</div>
                            <div class="legend-text-large">締付</div>
                        </div>
                        <div class="legend-item-modal">
                            <div class="legend-symbol-large" style="color: #00BCD4;">L</div>
                            <div class="legend-text-large">給油(水)</div>
                        </div>
                        <div class="legend-item-modal">
                            <div class="legend-symbol-large" style="color: #9e9e9e;">／</div>
                            <div class="legend-text-large">該当なし</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- トースト通知 -->
        <div class="toast" id="toast"></div>
    </div>

    <!-- 写真モーダル -->
    <div class="modal" id="photoModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="photoModalTitle">写真管理</h3>
                <button class="modal-close" onclick="closePhotoModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="photo-upload-area">
                    <input type="file" id="photoInput" accept="image/*" multiple capture="environment" style="display: none;">
                    <button class="photo-upload-btn" onclick="document.getElementById('photoInput').click()">
                        <i class="fas fa-camera"></i> 写真を撮影 / アップロード
                    </button>
                </div>
                <div class="photo-gallery" id="photoGallery"></div>
            </div>
        </div>
    </div>

    <!-- 部品追加モーダル -->
    <div class="modal" id="addPartModal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h3>部品を追加</h3>
                <button class="modal-close" onclick="closeAddPartModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <label class="input-label">部品名 <span class="required">*</span></label>
                    <input type="text" class="input-field" id="newPartName" placeholder="例：ブレーキパッド">
                </div>
                <div class="input-group">
                    <label class="input-label">単位 <span class="required">*</span></label>
                    <select class="input-field" id="newPartUnit">
                        <option value="個">個</option>
                        <option value="本">本</option>
                        <option value="L">L</option>
                        <option value="ml">ml</option>
                        <option value="セット">セット</option>
                        <option value="式">式</option>
                        <option value="枚">枚</option>
                    </select>
                </div>
                <div style="display: flex; gap: 8px; margin-top: 16px;">
                    <button class="btn btn-secondary" onclick="closeAddPartModal()" style="flex: 1;">
                        キャンセル
                    </button>
                    <button class="btn btn-primary" onclick="addCustomPart()" style="flex: 1;">
                        <i class="fas fa-plus"></i> 追加
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- カスタム点検項目追加モーダル -->
    <div class="modal" id="addCustomItemModal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h3>点検項目を追加</h3>
                <button class="modal-close" onclick="closeAddCustomItemModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <label class="input-label">点検項目名 <span class="required">*</span></label>
                    <input type="text" class="input-field" id="newCustomItemName" placeholder="例：エアコンフィルター">
                </div>
                <div style="display: flex; gap: 8px; margin-top: 16px;">
                    <button class="btn btn-secondary" onclick="closeAddCustomItemModal()" style="flex: 1;">
                        キャンセル
                    </button>
                    <button class="btn btn-primary" onclick="addCustomInspectionItem()" style="flex: 1;">
                        <i class="fas fa-plus"></i> 追加
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="js/api-helper.js"></script>
    <script src="js/inspection-data.js"></script>
    <script src="js/inspection.js"></script>
</body>
</html>
